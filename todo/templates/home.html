<!DOCTYPE html>
<html>
<head>
    <title>My ToDo App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow p-4">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">üìù My ToDo List</h3>
            <button onclick="toggleDarkMode()" class="btn btn-dark btn-sm">
                üåô Toggle Mode
            </button>
            
            <a href="{% url 'logout' %}" class="btn btn-danger btn-sm">Logout</a>
        </div>

        <hr>
        <!-- Dashboard Stats -->
<div class="row mb-4 text-center">

    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h5>Total Tasks</h5>
            <h3>{{ total_tasks }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-success">
            <h5>Completed</h5>
            <h3>{{ completed_tasks }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-warning">
            <h5>Pending</h5>
            <h3>{{ pending_tasks }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm p-3 text-primary">
            <h5>Completion</h5>
            <h3>{{ completion_rate }}%</h3>
        </div>
    </div>
</div>
<div class="progress mb-3" style="height: 25px;">
    <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
         role="progressbar"
         style="width: {{ completion_rate }}%;"
         aria-valuenow="{{ completion_rate }}"
         aria-valuemin="0"
         aria-valuemax="100">
         {{ completion_rate }}%
    </div>
</div>


        <!-- Add Task Form -->
        <form method="POST" class="d-flex mb-4">
            {% csrf_token %}
        
            <input type="text"
                   name="title"
                   class="form-control me-2"
                   placeholder="Enter new task..."
                   required>
        
            <input type="date"
                   name="due_date"
                   class="form-control me-2">
        
            <button type="submit" class="btn btn-primary">
                Add
            </button>
        </form>
        

        <!-- Task List -->
        <ul class="list-group">
            {% for task in tasks %}
            
                {% comment %} Overdue Condition {% endcomment %}
                {% if task.due_date and not task.completed and task.due_date < today %}
                    <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-danger">
                
                {% else %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                {% endif %}
            
                    <div>
            
                        {% if task.completed %}
                            <span class="text-decoration-line-through text-muted">
                                {{ task.title }}
                            </span>
                        {% else %}
                            <strong>{{ task.title }}</strong>
                        {% endif %}
            
                        <!-- Due Date Display -->
                        {% if task.due_date %}
                            <div class="small text-muted">
                                üìÖ {{ task.due_date|date:"d M Y" }}
            
                                {% if task.due_date == today and not task.completed %}
                                    <span class="badge bg-warning text-dark ms-2">
                                        Due Today
                                    </span>
                                {% endif %}
            
                                {% if task.due_date < today and not task.completed %}
                                    <span class="badge bg-danger ms-2">
                                        Overdue
                                    </span>
                                {% endif %}
                            </div>
                        {% endif %}
            
                    </div>
            
                    <div>
                        <a href="{% url 'complete' task.id %}" class="btn btn-success btn-sm">‚úî</a>
                        <a href="{% url 'edit' task.id %}" class="btn btn-warning btn-sm">Edit</a>
                        <a href="{% url 'delete' task.id %}" class="btn btn-danger btn-sm">Delete</a>
                    </div>
            
                </li>
            
            {% empty %}
                <li class="list-group-item text-center text-muted">
                    No tasks yet üöÄ
                </li>
            {% endfor %}
            </ul>
            


    </div>
</div>
<script>
    function toggleDarkMode() {
        document.body.classList.toggle("bg-dark");
        document.body.classList.toggle("text-white");
    
        localStorage.setItem("darkMode",
            document.body.classList.contains("bg-dark"));
    }
    
    window.onload = function() {
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("bg-dark", "text-white");
        }
    }
    </script>
    
</body>
</html>
